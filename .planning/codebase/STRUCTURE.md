# Codebase Structure

**Analysis Date:** 2026-02-19

## Directory Layout

```
Policy-Hub/
├── .planning/                    # GSD planning artifacts (generated by /gsd commands)
├── .config/                      # NPM config directory (generated)
├── .local/                       # Local state for Replit IDE (generated)
├── attached_assets/              # UI screenshots and design assets
├── client/                       # React frontend application
│   ├── public/                   # Static HTML and favicon
│   ├── src/
│   │   ├── components/           # Reusable UI components and layout
│   │   ├── hooks/                # Custom React hooks
│   │   ├── lib/                  # Shared utilities (React Query, API helpers)
│   │   ├── pages/                # Page-level components (routed)
│   │   ├── App.tsx               # Root component with providers and routing
│   │   ├── main.tsx              # React root render
│   │   └── index.css             # Global Tailwind imports
├── data/                         # Local file storage
│   ├── imports/                  # Import/export staging directory
│   └── uploads/
│       └── policies/             # Local document uploads (before S3)
├── migrations/                   # Drizzle database migrations (generated)
├── script/                       # Build and utility scripts
│   └── build.ts                  # ESBuild + Vite bundler
├── server/                       # Express backend application
│   ├── replit_integrations/      # Replit-specific integrations
│   │   ├── batch/                # Batch processing via Replit AI
│   │   └── chat/                 # Chat API integration
│   ├── db.ts                     # Drizzle database client setup
│   ├── index.ts                  # Express app bootstrap and middleware
│   ├── routes.ts                 # API endpoint definitions
│   ├── s3.ts                     # AWS S3 file upload/download utilities
│   ├── static.ts                 # Static file serving (production)
│   ├── storage.ts                # Data access layer (IStorage implementation)
│   └── vite.ts                   # Vite dev server setup (development)
├── shared/                       # Shared code between client and server
│   ├── models/                   # Specialized domain models
│   │   └── chat.ts               # Chat message types
│   ├── routes.ts                 # API endpoint contracts (paths, methods, schemas)
│   └── schema.ts                 # Database schema (Drizzle tables) and type exports
├── package.json                  # NPM dependencies and scripts
├── tsconfig.json                 # TypeScript configuration with path aliases
├── vite.config.ts                # Vite bundler configuration
├── tailwind.config.ts            # Tailwind CSS configuration
├── postcss.config.js             # PostCSS configuration
├── drizzle.config.ts             # Drizzle ORM migration config
├── components.json               # Shadcn component imports config
└── .replit                       # Replit environment configuration
```

## Directory Purposes

**client/**
- Purpose: React single-page application, compiled to static files
- Contains: React components, hooks, pages, styles, public assets
- Key files: `App.tsx` (root), `main.tsx` (entry), `pages/` (routes)

**client/src/components/**
- Purpose: Reusable UI components and layout shells
- Contains: Radix UI primitive wrappers (`ui/`), theme provider, sidebar, application-specific components
- Key files: `app-sidebar.tsx` (left sidebar), `ui/*.tsx` (50+ Radix UI wrappers)

**client/src/pages/**
- Purpose: Routed page components, one per major feature
- Contains: 27+ .tsx files, each is a full page with data fetching and layout
- Examples: `Dashboard.tsx`, `Documents.tsx`, `DocumentDetail.tsx`, `Requirements.tsx`, `RiskRegister.tsx`
- Size range: 700-1400 lines each (notably complex)

**client/src/hooks/**
- Purpose: Custom React hooks for shared behavior
- Contains: `use-mobile.tsx` (responsive design), `use-toast.ts` (Radix toast notifications)

**client/src/lib/**
- Purpose: Shared utilities and configuration
- Contains: `queryClient.ts` (React Query setup with custom fetch logic), `utils.ts` (helpers)

**server/**
- Purpose: Express backend, handles all API requests and database operations
- Contains: Route handlers, storage layer, database client, utilities
- Key files: `index.ts` (bootstrap), `routes.ts` (all endpoint handlers), `storage.ts` (data access)

**server/replit_integrations/**
- Purpose: Integration with Replit's AI and batch processing services
- Contains: Custom routing for AI chat, batch job processing
- Key files: `chat/index.ts`, `batch/index.ts`

**shared/**
- Purpose: Code shared between client and server, ensures type safety across boundary
- Contains: Database schema, API contracts, domain types
- Key files: `schema.ts` (Drizzle tables), `routes.ts` (API definitions), `models/chat.ts`

**migrations/**
- Purpose: Database schema version history (generated by Drizzle)
- Contains: Sequential numbered migration files with up/down SQL
- Generated by: `npm run db:push`

**data/**
- Purpose: Local file storage for uploads before S3 sync
- Contains: `imports/` (staging for batch imports), `uploads/policies/` (temporary PDFs)

**script/**
- Purpose: Build and deployment scripts
- Contains: `build.ts` (bundles client with Vite, server with esbuild)

**attached_assets/**
- Purpose: Screenshot and design asset repository
- Contains: 20+ UI screenshot images (`.png`)
- Generated by: Replit workspace capture tools

## Key File Locations

**Entry Points:**
- `server/index.ts`: Backend entry point, starts Express on PORT env var
- `client/src/main.tsx`: Frontend entry point, mounts React root
- `client/src/App.tsx`: Root React component, sets up providers and routing
- `script/build.ts`: Build script, compiles client and server for production

**Configuration:**
- `tsconfig.json`: TypeScript compiler options, path aliases (`@/*` → `client/src/*`, `@shared/*` → `shared/*`)
- `vite.config.ts`: Frontend bundler config, resolves aliases, defines root/output directories
- `drizzle.config.ts`: Database migration config, points to `shared/schema.ts` as schema source
- `tailwind.config.ts`: Tailwind CSS design system (colors, spacing, plugins)
- `components.json`: Shadcn CLI component registry

**Core Logic:**
- `shared/schema.ts`: Single source of truth for database structure (27+ tables)
- `shared/routes.ts`: API contract definitions for all 50+ endpoints
- `server/storage.ts`: IStorage interface implementation with 100+ methods (all CRUD operations)
- `server/routes.ts`: Express route handlers, 2000+ lines (POST/GET/PUT/DELETE handlers per entity type)
- `client/src/pages/`: 27 page components, largest are DocumentDetail (1379 lines), Documents (1190 lines)

**Data Access:**
- `server/db.ts`: Drizzle database client initialization
- `server/s3.ts`: AWS S3 helper functions (upload, download, presigned URLs, delete)
- `server/storage.ts`: Storage layer abstracting database operations

**Testing:**
- No test files found (`*.test.ts`, `*.spec.ts`)
- No Jest/Vitest configuration present

**Utilities:**
- `client/src/lib/queryClient.ts`: React Query config with custom fetch wrapper
- `client/src/lib/utils.ts`: Small utility functions (likely Tailwind merge, class utilities)

## Naming Conventions

**Files:**
- React components: PascalCase, `.tsx` for components, `.ts` for utilities
  - Examples: `Dashboard.tsx`, `DocumentDetail.tsx`, `app-sidebar.tsx`
- UI component wrappers: kebab-case, all in `ui/` directory
  - Examples: `card.tsx`, `dialog.tsx`, `tabs.tsx`, `input-otp.tsx`
- Database files: camelCase, named by function
  - Examples: `queryClient.ts`, `storage.ts`, `routes.ts`, `s3.ts`
- Directories: kebab-case for multi-word directories
  - Examples: `replit_integrations`, `attached_assets`, `public`

**Functions:**
- React component functions: PascalCase (matches file name for top-level components)
- Utility functions: camelCase, descriptive verb-noun pattern
  - Examples: `getQueryFn()`, `apiRequest()`, `registerRoutes()`, `createDocument()`
- Hooks: camelCase with `use` prefix
  - Examples: `useMobile()`, `useToast()`, `useQuery()`, `useMutation()`

**Variables:**
- Local variables and parameters: camelCase
- Constants: UPPER_SNAKE_CASE
  - Example in `build.ts` line 7: `const allowlist = [...]` (actual constants would be UPPER_CASE)
- React state: camelCase for both state and setter
  - Examples: `const [isLoading, setIsLoading]`, `const [formData, setFormData]`
- Database query results: camelCase matching table names singularized
  - Examples: `businessUnit`, `document`, `requirement`, `finding`

**Types:**
- Drizzle table infers: PascalCase
  - Examples: `Document`, `DocumentVersion`, `Requirement` (inferred from `documents` table via `$inferSelect`)
- API response types: PascalCase
  - Examples: `Stats`, `Finding[]`, `BusinessUnit[]`
- Zod schema names: camelCase with Schema suffix
  - Examples: `insertBusinessUnitSchema`, `insertDocumentVersionSchema`

**API Endpoints:**
- Pattern: `/api/{resource}` for collections, `/api/{resource}/:id` for single items
- Examples: `/api/business-units`, `/api/documents/:id`, `/api/requirements`, `/api/findings/:id`
- Resource names: kebab-case plural
- Methods: Standard REST (GET list, GET one, POST create, PUT update, DELETE delete)

**Route Keys in shared/routes.ts:**
- Pattern: `api.{resource}.{action}`
- Examples: `api.businessUnits.list`, `api.documents.get`, `api.requirements.create`
- Actions: list, get, create, update, delete

## Where to Add New Code

**New Feature/Entity:**
1. **Database Schema:** Add table definition to `shared/schema.ts` (line ~260+ for new tables)
   - Use pattern: `pgTable("table_name", { id: serial(...), ... })`
   - Export `$inferSelect` types for client consumption

2. **API Routes:** Define in `shared/routes.ts` (line ~200+)
   - Add `api.{resource}.{action}` object with `method`, `path`, `input` (Zod schema), `responses`
   - Use insert schema from schema.ts for input validation

3. **Storage Layer:** Add methods to `IStorage` interface in `server/storage.ts` (line ~150+)
   - Implement CRUD methods following existing pattern
   - Example pattern from line 35-39: `async getBusinessUnits(): Promise<BusinessUnit[]> { return db.query.businessUnits.findMany(); }`

4. **Route Handlers:** Add Express handlers to `server/routes.ts` (line ~32+ organized by resource)
   - Pattern: GET list, GET one (by id), POST create, PUT update, DELETE
   - Always validate input: `api.{resource}.{action}.input.parse(req.body)`
   - Handle errors: `if (err instanceof z.ZodError) return res.status(400).json(...)`

5. **Client Page/Component:** Create in `client/src/pages/` or `client/src/components/` respectively
   - Use `useQuery({ queryKey: ["/api/..."] })` for data fetching
   - Use `useMutation({ mutationFn: () => apiRequest(...) })` for mutations
   - Follow existing page structure (see DocumentDetail.tsx for complex example)

**New Component:**
- Location: `client/src/components/` for reusable, `client/src/components/ui/` for Radix wrappers
- Pattern: Functional component with TypeScript types
- Styling: Tailwind classes + Radix UI primitives
- Example: `client/src/components/app-sidebar.tsx` (480 lines, sidebar with navigation)

**New Utility Function:**
- Location: `client/src/lib/` for client utilities, `server/` root for backend utilities
- Pattern: Export named functions, avoid default exports
- Type it: Full TypeScript with explicit parameter and return types
- Example: `client/src/lib/queryClient.ts` functions `apiRequest()` and `getQueryFn()`

**New Hook:**
- Location: `client/src/hooks/`
- Pattern: Named `use{Name}.tsx` or `.ts`
- Return: React hook return type (state tuple, object of functions, etc.)
- Example: `client/src/hooks/use-mobile.tsx` (responsive breakpoint detection)

**New Page/Route:**
1. Create component in `client/src/pages/{PageName}.tsx`
2. Import page in `client/src/App.tsx` `Router()` function
3. Add `<Route path="/path" component={PageName} />` to Switch
4. API endpoints already in `shared/routes.ts` will work automatically via React Query

## Special Directories

**node_modules/**
- Purpose: Third-party dependencies (installed)
- Generated: Yes, via `npm install`
- Committed: No (in `.gitignore`)
- Size: ~500MB+

**dist/**
- Purpose: Production build output
- Generated: Yes, via `npm run build`
- Contains: `dist/index.cjs` (server bundle), `dist/public/` (client static files)
- Committed: No (generated at deploy time)

**migrations/**
- Purpose: Database schema version control
- Generated: Yes, via `npm run db:push` (Drizzle generates SQL migrations)
- Committed: Yes (required to recreate database state)
- Format: Numbered SQL files with timestamps

**.planning/**
- Purpose: GSD command output (architecture analysis, phase plans, execution logs)
- Generated: Yes, by `/gsd:*` commands
- Committed: No (local development only)
- Files: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md, INTEGRATIONS.md, STACK.md

**.local/**
- Purpose: Replit IDE local state
- Generated: Yes, by Replit environment
- Committed: No
- Contains: `.local/state/replit/` (IDE preferences)

**.config/**
- Purpose: NPM configuration
- Generated: Yes
- Committed: No

**data/uploads/**
- Purpose: Local file upload staging (before S3 sync)
- Generated: Yes, by application when users upload files
- Committed: No (temporary)
- Cleanup: Manual or by automated job

**attached_assets/**
- Purpose: Workspace screenshots and mockups
- Generated: Yes, by Replit screenshot tool
- Committed: No (large binary files)
- Contains: 20+ `.png` images

---

*Structure analysis: 2026-02-19*
